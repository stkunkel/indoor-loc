/*
 * mpu.c
 *
 *  Created on: Nov 3, 2015
 *      Author: ruppi
 */

//Includes
#include "mpu.h"

/*
 * Print Data and don't use MPU
 */
int printDataNoMPU() {
	//Variables
	int status, i;
	long temp_raw;
	short gyro_raw[3], acc_raw[3], compass_raw[3];
	float gyro_conv[3], acc_conv[3], compass_conv[3];
	unsigned long temp_timestamp;
	unsigned long int timestamp;

	//Gyro
	status = mpu_get_gyro_reg(gyro_raw, &timestamp);
	if (status != 0) {
		printf("mpu.c: Error getting Gyroscope data.\n\r");
		return 0;
	}

	printf("Gyro: (");
	for (i = 0; i < 3; i++) {
		printf("%d", gyro_raw[i]);
		if (i < 2) {
			printf(", ");
		} else {
			printf(")| ");
		}
	}

	//Acc
	status = mpu_get_accel_reg(accdata, &timestamp);
	if (status != 0) {
		printf("mpu.c: Error getting Gyroscope data.\n\r");
		return 0;
	}

	printf("Acc: (");
	for (i = 0; i < 3; i++) {
		printf("%d", acc_raw[i]);
		if (i < 2) {
			printf(", ");
		} else {
			printf(") | ");
		}
	}

	//Compass
	status = mpu_get_compass_reg(compass_raw, &timestamp);
	if (status != 0) {
		printf("mpu.c: Error getting Compass data.\n\r");
		return 0;
	}

	printf("Compass: (");
	for (i = 0; i < 3; i++) {
		printf("%d", compass_raw[i]);
		if (i < 2) {
			printf(", ");
		} else {
			printf(") | ");
		}
	}

	//Temperature
	status = mpu_get_temperature(&temp_raw, &temp_timestamp);
	if (status != 0) {
		printf("mpu.c: Error getting Temperature data.\r\n");
		return 0;
	}
	printf("Temperature: %fC\r\n", temp_raw / 65536.0);

	//Return
	return XST_SUCCESS;
}

/*
 * Convert Gyroscope Data using Sensitivity
 */
int convertGyroData(short raw[NUMBER_OF_AXES], float converted[NUMBER_OF_AXES]) {
	//Variables
	int status, i;
	float sensitivity;

	//get sensitivity
	status = mpu_get_gyro_sens(&sensitivity);
	if (status != XST_SUCCESS) {
		printf("mpu.c: Error getting sensitivity of gyroscope.\r\n");
		return XST_FAILURE;
	}

	//convert data
	for (i = 0; i <= NUMBER_OF_AXES; i++) {
		converted[i] = raw[i] / sensitivity;
	}

	//Return
	return XST_SUCCESS;
}

/*
 * Convert Accelerometer Data using Sensitivity
 */
int convertAccData(short raw[NUMBER_OF_AXES], float converted[NUMBER_OF_AXES]) {
	//Variables
	int status, i;
	unsigned short sensitivity;

	//get sensitivity
	status = mpu_get_accel_sens(&sensitivity);
	if (status != XST_SUCCESS) {
		printf("mpu.c: Error getting sensitivity of gyroscope.\r\n");
		return XST_FAILURE;
	}

	//convert data
	for (i = 0; i <= NUMBER_OF_AXES; i++) {
		converted[i] = raw[i] / sensitivity * 1.0;
	}

	//Return
	return XST_SUCCESS;
}

/*
 * Convert Magnetometer Data using Sensitivity
 */
int convertCompassData(short raw[NUMBER_OF_AXES],
		float converted[NUMBER_OF_AXES]) {
	//Variables
	int i;

	//convert data
	for (i = 0; i <= NUMBER_OF_AXES; i++) {
		converted[i] = raw[i] * MAG_SENS_FRS_1200;
	}

	//Return
	return XST_SUCCESS;
}

int convertTemperaturetoC(long* raw, float* converted) {
	//convert data
	*converted = *raw / 65536.0;

	//Return
	return XST_SUCCESS;
}
