/*
 * imu.h
 *
 *  Created on: Oct 28, 2015
 *      Author: rupprich
 */

#ifndef IMU_H_
#define IMU_H_

//Includes
#include <stdio.h>
#include "xil_types.h"
#include "xparameters.h"
#include "xgpiops.h"
#include "xstatus.h"
#include <xil_io.h>

//Zynq Parameters
#define GPIO_DEVICE_ID  	XPAR_XGPIOPS_0_DEVICE_ID //from xparameters.h
#define PS_IMU_AD0_PIN 	12 //MIO12
#define PS_IMU_INT_PIN 	13 //MIO13


//IMU Parameters
#define IMU_ADDR_MASK		0b1101000 	//b110100X - X determined by logic level on AD0
#define IMU_LAST_ADDR_BIT	0			//one IMU
#define GYRO_SENS_FRS_0		131			//LSB/(°/s) for FS_SEL = 0, 16-bit
#define GYRO_SENS_FRS_1		65.5		//LSB/(°/s) for FS_SEL = 1
#define GYRO_SENS_FRS_2		32.8		//LSB/(°/s) for FS_SEL = 2
#define GYRO_SENS_FRS_3		16.4		//LSB/(°/s) for FS_SEL = 3
#define ACC_SENS_FRS_0		16384		//LSB/g for AFS_SEL = 0, 16-bit, output in 2's complement format
#define ACC_SENS_FRS_1		8192		//LSB/g for AFS_SEL = 1
#define ACC_SENS_FRS_2		4096		//LSB/g for AFS_SEL = 2
#define ACC_SENS_FRS_3		2048		//LSB/g for AFS_SEL = 3
#define MAG_SENS_FRS_1200	0.3			//T/LSB for FRS = 1200, 13-bit, output in 2's complement format
#define TEMP_SENS_UNTRIMMED	340			//LSB/°C
#define TEMP_OFFSET_35C		-521		//LSB

//Functions
int imuI2cRead(unsigned char slave_addr, unsigned char reg_addr, unsigned char length, unsigned char *data);
int imuI2cWrite(unsigned char slave_addr, unsigned char reg_addr, unsigned char length, unsigned char *data);
void imuDelay(unsigned long ms);
int imuInit(u8 *imuAddr);
unsigned long imuGet_ms();
void imuLog_i();
void imuLog_e();

#endif /* IMU_H_ */
